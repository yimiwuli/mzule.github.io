title:Solr-appender想到的
time:2013-12-30 12:12:12
template:post.html
---
##1. 背景
前些日子分析线上日志感觉非常头疼。

1. 登录产线环境需要跳板机，速度不至于很慢，但也是不能忍受的事情。
2. 产线环境都是集群，有时候出错了都不知道该去哪台机器上去看错误日志。
3. 对自己而言，使用grep查询日志效率低。

综上，由于这些种种的原因，自己突然考虑：为什么日志不能直接写到solr服务上面去呢？单独开辟出来一个solr机器（集群就更好了XD）

##2. 开发
有了想法，二话不说，对log4j开刀，XXOO一会就解决了。方案见：

https://github.com/mzule/solr-appender

我还煞有介事的写了Getting Stated和Wiki (事实上，这个最耗时)。

##3. 应用
写完之后，拿着运行的效果图，发了一个微博圈了老大，建议TEAM使用solr来管理我们的log，对于查询来说，solr绝对是一把利剑。老大的答复是：公司已经开发了一套基于搜索引擎的日志管理系统，马上就要上线了。还给了我一个体验地址。好吧，太巧合了。

公司的这套系统，是一个日志采集系统，采集线上生成的日志文件，然后写入到solr中方便查询的。刚开始我表示很不理解，为什么不直接把日志写入到solr而要费时费力的去写到文件然后再采集？

##4. 后记
今天又是查线上的日志，想到要登录切换的登录机器去看日志，想想就头大。

心想，为什么不能直接把日志记录在solr中呢？下面我们来分析分析：

*性能*：性能什么的我觉得应该不是什么问题，在网络比硬盘快的时代，瓶颈在于硬盘，所以solr在性能方面不是问题。

*安全*：安全应该是一个使用solr记录日志所最需要考虑的一个问题了。记录日志文件是如此的重要，所以这个记录的过程应该越简单越好，保证错误的日志要能够被记录下来，而记录日志最简单的方式，可能就是写入文件了；将日志写入solr无疑会涉及比文件系统多的多的模块涉及进来，一个模块出现故障，日志就会丢失，所以安全性方面，solr不及文件系统。
